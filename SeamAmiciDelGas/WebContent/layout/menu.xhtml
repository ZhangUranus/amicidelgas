<h:form id="formMenu"
	xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a="http://richfaces.org/a4j">
    
    <rich:toolBar>
    	<rich:dropDownMenu style=" width : 42px;">	
       		<h:panelGrid cellpadding="0" cellspacing="0" columns="2"/>
    	</rich:dropDownMenu>	
    	
    	<rich:dropDownMenu style=" width : 58px;">
    		
    		<f:facet name="label"> 
            	<h:panelGroup>	
                    <h:outputText value="HOME"/>
                </h:panelGroup>
      		</f:facet>
      		
      		<rich:menuItem submitMode="none">
                    <s:link view="/home.xhtml" value="HOME GAS" propagation="none"/>
             </rich:menuItem>
    		
    		<rich:menuItem submitMode="none" rendered="#{identity.loggedIn and loginSelectBean.isCustomer}">
                    <s:link view="/customer/customerHome.xhtml" value="HOME UTENTE" propagation="none"/>
             </rich:menuItem>
             
             <rich:menuItem submitMode="none" rendered="#{identity.loggedIn and !loginSelectBean.isCustomer}">
                    <s:link view="/customer/customerHome.xhtml" value="HOME CONTADINO" propagation="none"/>
             </rich:menuItem>
    		
    	</rich:dropDownMenu>	
        
        <rich:dropDownMenu style=" width : 114px;" rendered="#{!identity.loggedIn}">
        	
        	<f:facet name="label"> 
    	        <h:panelGroup>
                      <h:outputText value="USER NON LOGGED"/>
                </h:panelGroup>
            </f:facet>
            
            <rich:menuItem submitMode="none">
                    <s:link view="/login.xhtml" value="LOGIN" propagation="none"/>
             </rich:menuItem>
        	
        	<rich:menuItem submitMode="none">
                    <s:link view="/registrazione.xhtml" value="REGISTRAZIONE" propagation="none"/>
             </rich:menuItem>        	
        	
        </rich:dropDownMenu>
        
        <rich:dropDownMenu style=" width : 78px;" rendered="#{identity.loggedIn and loginSelectBean.isCustomer}">
        	
        	<f:facet name="label"> 
    	        <h:panelGroup cellpadding="0" cellspacing="0" columns="2">
                      <h:outputText value="CUSTOMER" />
                </h:panelGroup>
            </f:facet>
            
            <rich:menuItem submitMode="none" >
                    <s:link view="/customer/visualizzaOrdini.xhtml" value="ORDINI" propagation="none"/>
             </rich:menuItem>
        	
        	 <rich:menuItem submitMode="none" >
                    <s:link view="/customer/editDati.xhtml" value="PROFILO" propagation="none">
                    	<f:param name="utenteCodiceFiscale" value="#{currentUser.codiceFiscale}"/>
		                <f:param name="accountUsername" value="#{currentAccount.username}"/>
		            </s:link>
             </rich:menuItem>
             
             <rich:menuItem submitMode="none" >
                    <s:link view="/customer/inviaNotifiche.xhtml" value="INVIA NOTIFICHE" propagation="none"/>
                    <f:param name="utenteCodiceFiscale" value="#{currentUser.codiceFiscale}"/>
		            <f:param name="accountUsername" value="#{currentAccount.username}"/>
             </rich:menuItem> 
             
             <rich:menuItem submitMode="none" >
                    <s:link view="/customer/riceviNotifiche.xhtml" value="NOTIFICHE RICEVUTE (#{pooledTaskInstanceList.size() + taskInstanceList.size()})" propagation="none"/>
                    <f:param name="utenteCodiceFiscale" value="#{currentUser.codiceFiscale}"/>
		            <f:param name="accountUsername" value="#{currentAccount.username}"/>
             </rich:menuItem> 
             
             <rich:menuItem submitMode="none" >
                    <s:link view="/customer/browseCatalog.xhtml" value="VEDI CATALOGO" propagation="none"/>
                    <f:param name="utenteCodiceFiscale" value="#{currentUser.codiceFiscale}"/>
		            <f:param name="accountUsername" value="#{currentAccount.username}"/>
             </rich:menuItem>
             
             <rich:menuItem submitMode="none" >
                    <s:link view="/customer/questionario.xhtml" value="QUESTIONARIO" propagation="none"/>
             </rich:menuItem>	
        	
        </rich:dropDownMenu>	
    
    	<rich:dropDownMenu style=" width : 85px;" rendered="#{identity.loggedIn and (loginSelectBean.calculateMaxRole()=='mediatore' or loginSelectBean.calculateMaxRole()=='admin')}">
        	
        	<f:facet name="label"> 
    	        <h:panelGroup cellpadding="0" cellspacing="0" columns="2">
                      <h:outputText value="MEDIATORE" />
                </h:panelGroup>
            </f:facet>
            
            <rich:menuItem submitMode="none">
                    <s:link view="/mediatore/accettaRegistrazioni.xhtml" value="RICHIESTE REGISTRAZIONI" propagation="none"/>
             </rich:menuItem>
             
             <rich:menuItem submitMode="none">
                    <s:link view="/mediatore/puntiDiConsegna.xhtml" value="PUNTI DI CONSEGNA" propagation="none"/>
             </rich:menuItem>
             
             <rich:menuItem submitMode="none">
                    <s:link view="/mediatore/richiesteDriver.xhtml" value="RICHIESTE DRIVER" propagation="none"/>
             </rich:menuItem>
        	
        </rich:dropDownMenu>
        
    	<rich:dropDownMenu style=" width : 51px;" rendered="#{identity.loggedIn and loginSelectBean.calculateMaxRole()=='admin'}">
        	
        	<f:facet name="label"> 
    	        <h:panelGroup cellpadding="0" cellspacing="0" columns="2">
                      <h:outputText value="ADMIN" />
                </h:panelGroup>
            </f:facet>
            	
        	<rich:menuItem submitMode="none">
                    <s:link view="/admin/editDatiUtenti.xhtml" value="UTENTI REGISTRATI" propagation="none">
             			<f:param name="utenteCodiceFiscale" value="#{currentUser.codiceFiscale}"/>
		            	<f:param name="accountUsername" value="#{currentAccount.username}"/>
		            </s:link>
             </rich:menuItem>
             
             <rich:menuItem submitMode="none">
                    <s:link view="/admin/editDatiCybercontadino.xhtml" value="CONTADINI REGISTRATI" propagation="none">
             			<f:param name="utenteCodiceFiscale" value="#{currentUser.codiceFiscale}"/>
		            	<f:param name="accountUsername" value="#{currentAccount.username}"/>
		            </s:link>
             </rich:menuItem>
        	
        </rich:dropDownMenu>
        
        <rich:dropDownMenu style=" width : 82px;" rendered="#{identity.loggedIn and loginSelectBean.calculateMaxRole()=='utenteContadino'}">
        	
        	<f:facet name="label"> 
    	        <h:panelGroup cellpadding="0" cellspacing="0" columns="2">
                      <h:outputText value="CONTADINO"/>
                </h:panelGroup>
            </f:facet>
            	
        	
        </rich:dropDownMenu>
        
        <rich:dropDownMenu style=" width : 50px;" rendered="#{identity.loggedIn and loginSelectBean.isCustomer}">	
       		
       		<f:facet name="label"> 
    	        <h:panelGroup>
    	        	<a:commandLink ajaxSingle="true" id="carrelloLink"
			                    oncomplete="#{rich:component('carrelloPanel')}.show()">
 					<h:graphicImage value="/img/shopping_cart.png" styleClass="pic" width="35" height="28"/>    	        		
                    </a:commandLink>
                </h:panelGroup>
            </f:facet>
       		
    	</rich:dropDownMenu>
        
    
    	<rich:dropDownMenu style=" width : 50px;" rendered="#{identity.loggedIn}">	
       		
       		<f:facet name="label"> 
    	        <h:panelGroup>
                      <s:link view="/home.xhtml" action="#{identity.logout}" value="LOGOUT" propagation="none"/>
                </h:panelGroup>
            </f:facet>
       		
    	</rich:dropDownMenu>	
    
    	<rich:dropDownMenu style=" width : 50px;" rendered="#{identity.loggedIn}">	
       		
       		<f:facet name="label"> 
    	        <h:panelGroup>
                      <h:outputText style="color:red" value="LOGGED AS: #{identity.username}" />
                </h:panelGroup>
            </f:facet>
       		
    	</rich:dropDownMenu>	
    
    </rich:toolBar>
    
    <rich:modalPanel id="carrelloPanel" autosized="true" width="500">
       	<f:facet name="header">
           	<h:outputText value="Visualizzazione carrello" />
       	</f:facet>
       	<f:facet name="controls">
           	<h:panelGroup>
               	<h:graphicImage value="/img/close.png"
                   	id="hidelink" />
              	 	<rich:componentControl for="carrelloPanel" attachTo="hidelink"
                   	operation="hide" event="onclick" />
           	</h:panelGroup>
   	    </f:facet>
   	    <h:panelGrid columns="1">
	        	<a:outputPanel ajaxRendered="true">
			        <b><h:outputText value="Prodotti nel carrello" /></b>
							<rich:dataTable var="_itemCarrello" id="itemsDataTableShoppingCart"
								value="#{shoppingCart.itemInShoppingCart}">
								<rich:column>
										<f:facet name="header">Nome prodotto</f:facet>
										<h:outputText value="#{_itemCarrello.item.name}"/>
								</rich:column>	
								<rich:column>
										<f:facet name="header">Quantita prodotto</f:facet>
										<h:outputText value="#{_itemCarrello.quantita}"/>
								</rich:column>	
								<rich:column>
										<f:facet name="header">Prezzo totale per prodotto</f:facet>
										<h:outputText value="#{_itemCarrello.quantita * _itemCarrello.item.prezzo} euro"/>
								</rich:column>
								<rich:column>
										<f:facet name="header">Evasione Parziale</f:facet>
										<h:form>
										<h:selectBooleanCheckbox required="true" value="#{_itemCarrello.evasioneParziale}" > 
											<a:support event="onclick" ajaxSingle="true" reRendered="qParzialeField"/>
					  					</h:selectBooleanCheckbox>
					  					
					  					
				  						<a:outputPanel ajaxRendered="true">
											<s:decorate id="qParzialeField" rendered="#{_itemCarrello.evasioneParziale}">
												<rich:inputNumberSpinner id="qParzialeCarrello" 
									 							minValue="0" maxValue="#{_itemCarrello.quantita}" step="1"
									 							style="height : 15px; width : 20px;" 
									 						    value="#{_itemCarrello.quantitaParziale}">
									 			</rich:inputNumberSpinner>					
											</s:decorate>
										</a:outputPanel>
										</h:form>
								</rich:column>
								<rich:column>
										<f:facet name="header">Elimina dal carrello</f:facet>
										<a:commandButton id="commandButtonShoppingCartDelete" image="/img/shopping_cart2_delete.jpg"
														  style="width : 25px; height : 25px;">
						 					<a:support event="onclick" reRender="shoppingcartField" ajaxSingle="true"
						 						   action="#{shoppingCart.deleteItemInShoppingCart(_itemCarrello.item, takeInHand.getHowMuchForItem(_itemCarrello.item))}"/>
						 				</a:commandButton>
						 				<rich:toolTip for="commandButtonShoppingCartDelete" value="Elimina prodotto dal carrello"/>
								</rich:column>	
							</rich:dataTable>
						<br/>
						<h:panelGrid columns="3">
							<h:outputText><b>TOTALE: </b></h:outputText>
							<h:outputText value="#{shoppingCart.calcolaTotale()} euro"/>
						</h:panelGrid>
						<br/>
						<a:commandButton bypassUpdates="true" ajaxSingle="true" value="Avvia l'ordine"
	                			action="#{shoppingCart.calcolaTotale()}"
	                			oncomplete="#{rich:component('carrelloPanel')}.hide()" />
				</a:outputPanel>
			</h:panelGrid>	    
	</rich:modalPanel>
    
</h:form>