<?xml version="1.0" encoding="UTF-8"?>

<process-definition  xmlns=""  name="notificaRegistrazione">


	<start-state name="Richiesta registrazione">
		<transition to="Crea Evento Azienda da visitare" name="inviaRegistrazione"></transition>
	</start-state>


	<task-node name="Crea Evento Azienda da visitare">
		<task name="crea_visita">
			<assignment pooled-actors="mediatore"></assignment>
		</task>
		<transition to="SubProcessNotifica" name="invia"></transition>
	</task-node>

	<task-node name="partecipa al gruppo">
		<task name="partecipa_alla_visita" >
			<assignment pooled-actors="utenteGas"></assignment>
		</task>
		 <event type="timer-create">
      <action name="timerCreated" class="org.domain.SeamAmiciDelGas.processes.ChangeDueDateTimer">
        <timerName>varTimer</timerName>
      </action>
    </event>
		<event type="node-leave">
			<action name="SpegniTuttoeVaiAvanti" class="org.domain.SeamAmiciDelGas.processes.CancelTaskAction"></action>
		</event>
    <timer duedate="10 years" name="varTimer" transition="time-out"/>
		<transition to="accetta altri utenti" name="partecipa"></transition>
		<transition to="join1" name="time-out"></transition>
	</task-node>

	<task-node name="Riempire questionario (Visualizza Admin)">
		<task name="compilaQuestionario">
			<assignment pooled-actors="utenteContadino"></assignment>
		</task>
		<transition to="Contadino Accettato" name="fine"></transition>
	</task-node>

	<decision name="accetta altri utenti">
		<transition to="partecipa al gruppo" name="posti disponibili">
			<condition expression="#{!(postiOccupati &gt;= 3)}"></condition>
		</transition>
		<transition to="join1" name="posti esauriti">
			<condition expression="#{postiOccupati ==3}"></condition>
		</transition>
	</decision>

	<fork name="fork1">
		<transition to="accetta altri utenti"></transition>
		<transition to="join1" name="to join1"></transition>
	</fork>

	<join name="join1"></join>

	<process-state name="SubProcessNotifica">
		<sub-process name="notificatore"></sub-process>
		<variable access="read" name="inviati" mapped-name="recipients"></variable>
		<variable access="read" name="contenutoMessaggio" mapped-name="content"></variable>
		<variable access="read" name="mioBroadcast" mapped-name="broadcast"></variable>
		<transition to="Riempire questionario (Visualizza Admin)" name="rispostaQuestionario"></transition>
	</process-state>


	<end-state name="Contadino Accettato"></end-state>



</process-definition>