<?xml version="1.0" encoding="UTF-8"?>

<process-definition  xmlns=""  name="myOrderProcessing">


	<start-state name="L'utente sottomette un ordine">
		<transition to="Ordine notificato a driver e contadini" name="invia_notifica_ai_gruppi_driver_contadino"></transition>
	</start-state>


	<task-node name="Ordine notificato a driver e contadini">
		<task name="accetta_ordine">
			<assignment pooled-actors="driver,utenteContadino"></assignment>
		</task>
		<transition to="Notifica utente ordine non preso in carico" name="ordine_non_preso_in_carico_entro_datamax"></transition>
		<transition to="Verifica disponibilita" name="ordine_preso_in_carico"></transition>
		<transition to="end-state1" name="ordine_eliminato_dall_utente"></transition>
	</task-node>

	<task-node name="Notifica utente ordine non disponibile">
		<task name="ReceiveOrderFailed">
			<assignment actor-id="#{customer}"></assignment>
		</task>
		<transition to="Ordine notificato a driver e contadini" name="ordine_rimesso_nel_pool"></transition>
	</task-node>

	<task-node name="Notifica utente ordine non preso in carico">
		<transition to="end-state2"></transition>
	</task-node>

	<task-node name="Notifica utente ordine preso in carico">
		<task name="ReceiveOrderAccepted">
			<assignment actor-id="#{customer}"></assignment>
		</task>
		<transition to="Attendi data consegna"></transition>
	</task-node>

	<state name="Attendi data consegna">
		<transition to="fork1"></transition>
	</state>

	<task-node name="Rilascia feedback all'utente">
		<transition to="join1"></transition>
	</task-node>

	<fork name="fork1">
		<transition to="Rilascia feedback all'utente" name="to Rilascia feedback all'utente"></transition>
		<transition to="Rilascia feedback al contadino o driver" name="to Rilascia feedback al contadino o driver"></transition>
	</fork>

	<task-node name="Rilascia feedback al contadino o driver">
		<transition to="join1"></transition>
	</task-node>

	<join name="join1">
		<transition to="end-state3"></transition>
	</join>

	<decision name="Verifica disponibilita">
		<transition to="Notifica utente ordine preso in carico" name="ordine_evaso">
			<condition expression="#{!myOrdine.pendente and myOrdine.evaso}"></condition>
		</transition>
		<transition to="Notifica utente ordine non disponibile" name="ordine_non_evaso">
		<condition expression="#{myOrdine.pendente and !myOrdine.evaso}"></condition>
		</transition>
	</decision>


	<end-state name="end-state1"></end-state>

	<end-state name="end-state2"></end-state>

	<end-state name="end-state3"></end-state>


</process-definition>