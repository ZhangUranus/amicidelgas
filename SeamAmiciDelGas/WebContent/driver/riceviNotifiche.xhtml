<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a="http://richfaces.org/a4j"
    template="/layout/template.xhtml">

	<ui:define name="body">
		
		<rich:simpleTogglePanel label="Itinerari creati">
		<h:form>
		        <a:region>
			<rich:dataTable id="dataTableItinerari" 
								value="#{matchItinerarioOrdine.loadItinerari()}" var="_itinerario"
								width="90%" align="center" >
				<rich:column>
					<f:facet name="header">Id</f:facet>    
					<h:outputText value="#{_itinerario.iditinerario}"/>
				</rich:column>
				<rich:column>
					<f:facet name="header">Data creazione</f:facet>    
					<h:outputText value="#{_itinerario.dataCreazione}">
						<f:convertDateTime type="date" dateStyle="medium" locale="Locale.ITALY"/>
					</h:outputText>
				</rich:column>
				<rich:column>
					<f:facet name="header">Data consegna</f:facet>    
					<h:outputText value="#{_itinerario.dataConsegna}">
						<f:convertDateTime type="date" dateStyle="medium" locale="Locale.ITALY"/>
					</h:outputText>
				</rich:column>
				<rich:column>
					<f:facet name="header">Contadini da visitare</f:facet>    
					<a:commandLink ajaxSingle="true" id="listaContadiniPerItinerarioLink"
				        	oncomplete="#{rich:component('listaContadiniPerItinerario')}.show()">
				        <f:setPropertyActionListener value="#{_itinerario}" target="#{matchItinerarioOrdine.currentItinerario}" />
					    <h:graphicImage value="/img/contadino50x36.gif" style="border:0" />
					</a:commandLink>
				</rich:column>
				<rich:column>
					<f:facet name="header">Punti di consegna</f:facet>    
					<a:commandLink ajaxSingle="true" id="puntiDiConsegnaLink"
				        	oncomplete="#{rich:component('puntiDiConsegnaPanel')}.show()">
				        <f:setPropertyActionListener value="#{_itinerario}" target="#{matchItinerarioOrdine.currentItinerario}" />
					    <h:graphicImage value="/img/itinerario_small.png" style="border:0" />
					</a:commandLink>
				</rich:column>
				<rich:column>
					<f:facet name="header">Seleziona</f:facet>
					<a:commandButton event="onclick"
									 value="Seleziona questo itinerario">
						<f:setPropertyActionListener value="#{_itinerario}"
								target="#{matchItinerarioOrdine.currentItinerario}" />
						<a:support event="onclick" reRender="ordiniPerItinerarioCorrente"></a:support>
					</a:commandButton>
				</rich:column>

			</rich:dataTable>
			</a:region>
		</h:form>
		</rich:simpleTogglePanel>
		 
		<br/><br/><br/>
		 
		<rich:modalPanel id="listaContadiniPerItinerario" autosized="true" width="350">
       		<f:facet name="header">
            	<h:outputText value="Contadini"/>
        	</f:facet>
       		<f:facet name="controls">
            	<h:panelGroup>
                	<h:graphicImage value="/img/close.png"
                    	id="hidelink1" />
               	 	<rich:componentControl for="listaContadiniPerItinerario" attachTo="hidelink1"
                    	operation="hide" event="onclick" />
            	</h:panelGroup>
        	</f:facet>
        	<a:outputPanel ajaxRendered="true">
	        	<rich:dataTable id="dataTableContadini" 
								value="#{matchItinerarioOrdine.currentListCybercontadino}" var="_contadino"
								width="90%" align="center" >
				<h:column>
					<f:facet name="header">Username</f:facet>
					<h:outputText value="#{_contadino.account.username}"/>
				</h:column>			
				<h:column>
					<f:facet name="header">Comune</f:facet>
					<h:outputText value="#{_contadino.comune.nome}"/>
				</h:column>		
				<h:column>
					<f:facet name="header">Nome azienda</f:facet>
					<h:outputText value="#{_contadino.nomeAzienda}"/>
				</h:column>						
					
				</rich:dataTable>
			</a:outputPanel>	
       	</rich:modalPanel>
		
		<rich:modalPanel id="puntiDiConsegnaPanel" autosized="true" width="350">
       		<f:facet name="header">
            	<h:outputText value="Punti di consegna"/>
        	</f:facet>
       		<f:facet name="controls">
            	<h:panelGroup>
                	<h:graphicImage value="/img/close.png"
                    	id="hidelink2" />
               	 	<rich:componentControl for="puntiDiConsegnaPanel" attachTo="hidelink2"
                    	operation="hide" event="onclick" />
            	</h:panelGroup>
        	</f:facet>
        	<a:outputPanel ajaxRendered="true">
	        	<rich:dataTable id="dataTableItinerari2" 
								value="#{matchItinerarioOrdine.currentListPuntiDiConsegna}" var="_puntoDiConsegna"
								width="90%" align="center" >
				<h:column>
					<f:facet name="header">Comune</f:facet>
					<h:outputText value="#{_puntoDiConsegna.comune.nome}"/>
				</h:column>			
				<h:column>
					<f:facet name="header">Indirizzo</f:facet>
					<h:outputText value="#{_puntoDiConsegna.indirizzo}"/>
				</h:column>						
				</rich:dataTable>
			</a:outputPanel>	
       	</rich:modalPanel>
       	
		
		<br/><br/><br/>
		
		<rich:simpleTogglePanel label="Ordini per itinerario">
			<s:decorate id="ordiniPerItinerarioCorrente" >
			<a:outputPanel ajaxRendered="true">
			<h:form>	
				<rich:dataTable id="ordini" width="90%" align="center"
							value="#{matchItinerarioOrdine.loadTaskInstanceForItinerario()}" 
							var="_task">
					<rich:column>
						<f:facet name="header">Mittente</f:facet>    
				         <h:outputText value="#{_task.variables.customer.username}"/>
					</rich:column>
					<rich:column>
						<f:facet name="header">Contenuto messaggio</f:facet>    
				         <h:outputText value="#{_task.variables.notificaDriverContadino.content}"/>
					</rich:column>
					<rich:column align="center">
                		<f:facet name="header">Dettagli Ordine</f:facet>
				                	
		                	<a:commandLink ajaxSingle="true" id="dettagliOrdinePendenteLink"
		                    	oncomplete="#{rich:component('dettagliOrdinePanel')}.show()">
		                    	<f:setPropertyActionListener value="#{ordineBean.getOrdineFromTask(_task)}" 
		                    								target="#{ordineBean.currentMyOrder}" />
			                    <h:graphicImage value="/img/modifica_mini.png" style="border:0" />
			                </a:commandLink>
                		<rich:toolTip for="dettagliOrdinePendenteLink" value="Visualizza i dettagli dell'ordine"/>
	            	</rich:column>
					<rich:column width="10%">
						<f:facet name="header">Accetta</f:facet>
						<s:button taskInstance="#{_task}" action="#{orderProcessing.verificaDisponibilita(matchItinerarioOrdine.currentItinerario)}"
								  value="Accetta ordine"/>
					</rich:column>
				</rich:dataTable>
			</h:form>
			</a:outputPanel>
			</s:decorate>
		</rich:simpleTogglePanel>
		
		<a:outputPanel ajaxRendered="true">
		<rich:modalPanel id="dettagliOrdinePanel" autosized="true" width="350">
       		<f:facet name="header">
            	<h:outputText value="Dettagli ordini" />
        	</f:facet>
       		<f:facet name="controls">
            	<h:panelGroup>
                	<h:graphicImage value="/img/close.png" styleClass="hidelink" id="hidelink4"/>
               	 	<rich:componentControl for="dettagliOrdinePanel" attachTo="hidelink4" operation="hide" event="onclick" />
            	</h:panelGroup>
        	</f:facet>
			<ui:define name="label">Prodotti dell'ordine</ui:define>
			<rich:dataTable var="_itemCarrello" id="itemsDataTableOrdiniFatti"
				value="#{ordineBean.currentMyOrder.itemQuantita}">
				<rich:column>
						<f:facet name="header">Nome prodotto</f:facet>
						<h:outputText value="#{_itemCarrello.item.name}"/>
				</rich:column>	
				<rich:column>
					<f:facet name="header">Username contadino</f:facet>
					<h:outputText value="#{_itemCarrello.cybercontadino.account.username}"/>
				</rich:column>	
				<rich:column>
						<f:facet name="header">Quantita prodotto</f:facet>
						<h:outputText value="#{_itemCarrello.quantita}"/>
				</rich:column>	
				<rich:column>
						<f:facet name="header">Totale per prodotto</f:facet>
						<h:outputText value="#{_itemCarrello.quantita * _itemCarrello.item.prezzo} euro"/>
				</rich:column>
				<rich:column>
					<f:facet name="header">Quantita minima</f:facet>
					<h:outputText value="#{_itemCarrello.quantitaParziale}"/>
				</rich:column>				
			</rich:dataTable>

       	</rich:modalPanel>
     </a:outputPanel>
		
	</ui:define>
	
</ui:composition>
