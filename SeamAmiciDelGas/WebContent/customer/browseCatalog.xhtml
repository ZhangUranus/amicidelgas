<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a="http://richfaces.org/a4j" template="/layout/template.xhtml">



	<ui:define name="body">
		<rich:simpleTogglePanel label="Seleziona il fornitore per visualizzare il catalogo">
			<h:form id="browseForm">
				<s:decorate id="contadinoField" template="/layout/edit.xhtml">
					<rich:dataTable id="tabellaContadini" var="_contadino"
							value="#{cybercontadinoList.resultList}" rows="5">
						<rich:column> 
							<f:facet name="header">Nome Azienda</f:facet>
							<h:outputText value="#{_contadino.nomeAzienda}"/>
						</rich:column>
						<rich:column>
							<f:facet name="header">Comune</f:facet>
							<h:outputText value="#{_contadino.comune.nome}"/>
						</rich:column>	
						<rich:column>
							<f:facet name="header">Seleziona</f:facet>
							<s:button action="updateContadino"
									   value="Seleziona questo fornitore">
								<f:setPropertyActionListener value="#{_contadino}"
									target="#{catalogService.contadino}" />
								<a:support event="onclick" reRender="categoriesField"></a:support>
							</s:button>
						</rich:column>
					</rich:dataTable>
					<rich:datascroller align="center" for="tabellaContadini" />
				</s:decorate>
			</h:form>
		</rich:simpleTogglePanel>
		
	 	<br/>
	 	<br/>
	 	<br/>
		
		<rich:simpleTogglePanel label="Categorie e prodotti">
		<h:form id="formCategory">
			<s:decorate id="categoriesField" template="/layout/edit.xhtml">
			
			<table width="96%" border="1" cellspacing="0" cellpadding="0" align="center" >
			<tr>
			<td colspan="3">
				<table width="90%" border="1" cellspacing="4" cellpadding="4" align="left" >	 
					<tr>
					<td>
						<rich:dataTable value="#{catalogService.getCategories(catalogService.contadino.partitaIva)}"
										var="_category"
										width="20%">
							<rich:column> 
							<f:facet name="header">Categoria</f:facet>	
								<a:commandButton event="onclick" value="#{_category}"
											    action="#{catalogService.getItemsForCategory(catalogService.contadino,_category)}"
									          reRender="productsField" bypassUpdates="true"
											ajaxSingle="true">
									<f:setPropertyActionListener value="#{_category}"
										target="#{catalogService.currentCategory}" />
									<a:support event="onclick" ajaxSingle="true"
							 				 action="#{takeInHand.azzeraHowMuch()}"/>
								</a:commandButton>
							</rich:column>	
						</rich:dataTable>
					</td>	
					<td>
						<s:decorate id="productsField" template="/layout/edit.xhtml">
								<ui:define name="label">Prodotti</ui:define>
								<rich:dataTable var="_item" id="itemsDataTable"
									value="#{catalogService.getItemsForCategory(catalogService.contadino, catalogService.currentCategory)}">
									
									<rich:column> 
										<f:facet name="header">Nome Prodotto</f:facet>
										<h:outputText value="#{_item.name}"/>
									</rich:column>
									
									<rich:column>
										<f:facet name="header">Descrizione</f:facet>
										<h:outputText value="#{_item.description}"/>
									</rich:column>	
									
									<rich:column>
										<f:facet name="header">Prezzo unitario</f:facet>
										<h:outputText value="#{_item.prezzo} euro"/>
									</rich:column>		
									
									<rich:column colspan="2">
										<f:facet name="header">Aggiungi al carrello</f:facet>
								 			<rich:inputNumberSpinner id="inputNumberSpinnerCarrello" 
								 							minValue="0" maxValue="1000" step="1"
								 							style="height : 15px; width : 20px;" 
								 						    value="#{takeInHand.howMuch}">
								 				<a:support	event="onclick" reRender="valoreCarrelloColumn" action="#{takeInHand.addHowMuch(_item, takeInHand.howMuch)}"
								 							ajaxSingle="true"/>
								 			</rich:inputNumberSpinner>						  	
								  			<a:commandButton id="commandButtonShoppingCart" image="/img/shopping_cart2.jpg" style="width : 25px; height : 25px;">
							 					<a:support event="onclick" reRender="shoppingcartField" ajaxSingle="true"
							 						   action="#{shoppingCart.addItemInShoppingCart(_item, takeInHand.getHowMuchForItem(_item))}"/>
							 				</a:commandButton>
							 				<rich:toolTip for="commandButtonShoppingCart" value="Aggiungi prodotto al carrello"/>
									</rich:column>
									
									<rich:column id="valoreCarrelloColumn">
										<f:facet name="header">Totale per prodotto</f:facet> 
										<a:outputPanel ajaxRendered="true">
											<h:outputText value="#{takeInHand.getHowMuchForItem(_item) * _item.prezzo} euro"/>
										</a:outputPanel>
									</rich:column>	
								</rich:dataTable>
							</s:decorate>
						</td>
						</tr>
					</table>
				</td>
				</tr>
				<tr>
				<td>
				<table width="96%" border="2" cellspacing="0" cellpadding="0" align="center">
					<tr>
						<td>
							<s:decorate id="shoppingcartField" template="/layout/edit.xhtml">
								<table>
								<tr>
								<td>
									<ui:define name="label">Prodotti nel carrello</ui:define>
									<rich:dataTable var="_itemCarrello" id="itemsDataTableShoppingCart"
										value="#{shoppingCart.itemInShoppingCart}">
										<rich:column>
												<f:facet name="header">Nome prodotto</f:facet>
												<h:outputText value="#{_itemCarrello.item.name}"/>
										</rich:column>	
										<rich:column>
												<f:facet name="header">Quantita prodotto</f:facet>
												<h:outputText value="#{_itemCarrello.quantita}"/>
										</rich:column>	
										<rich:column>
												<f:facet name="header">Prezzo totale per prodotto</f:facet>
												<h:outputText value="#{_itemCarrello.quantita * _itemCarrello.item.prezzo} euro"/>
										</rich:column>
										<rich:column>
												<f:facet name="header">Elimina dal carrello</f:facet>
												<a:commandButton id="commandButtonShoppingCartDelete" image="/img/shopping_cart2_delete.jpg"
																  style="width : 25px; height : 25px;">
								 					<a:support event="onclick" reRender="shoppingcartField" ajaxSingle="true"
								 						   action="#{shoppingCart.deleteItemInShoppingCart(_itemCarrello.item, takeInHand.getHowMuchForItem(_itemCarrello.item))}"/>
								 				</a:commandButton>
								 				<rich:toolTip for="commandButtonShoppingCartDelete" value="Elimina prodotto dal carrello"/>
										</rich:column>	
									</rich:dataTable>
								</td>
								<td>
									<b><h:outputText value="TOTALE "/></b>
									<br/>
									<h:outputText value="#{shoppingCart.calcolaTotale()} euro"/>
								</td>
								</tr>
							</table>
							</s:decorate>
						</td>
					</tr>
				</table>
				</td>
				</tr>
			</table>	
		</s:decorate>				
		</h:form>
	</rich:simpleTogglePanel>
	</ui:define>

</ui:composition>

