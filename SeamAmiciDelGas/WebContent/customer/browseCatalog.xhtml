<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a="http://richfaces.org/a4j" template="/layout/template.xhtml">



	<ui:define name="body">
		<rich:simpleTogglePanel label="Seleziona il fornitore per visualizzare il catalogo">
			<h:form id="browseForm">
				<s:decorate id="contadinoField" template="/layout/edit.xhtml">
					<rich:dataTable id="tabellaContadini" var="_contadino"
							value="#{cybercontadinoList.resultList}">
						<rich:column> 
							<f:facet name="header">Nome Azienda</f:facet>
							<h:outputText value="#{_contadino.nomeAzienda}"/>
						</rich:column>
						<rich:column> 
							<f:facet name="header">Descrizione Azienda</f:facet>
							<h:outputText value="#{_contadino.descrizioneAzienda}"/>
						</rich:column>
						<rich:column>
							<f:facet name="header">Comune</f:facet>
							<h:outputText value="#{_contadino.comune.nome}"/>
						</rich:column>	
						<rich:column>
							<f:facet name="header">Seleziona</f:facet>
							<a:commandButton event="onclick"
									   value="Seleziona questo fornitore">
								<f:setPropertyActionListener value="#{_contadino}"
									target="#{catalogService.contadino}" />
								<a:support event="onclick" reRender="categoriesField"></a:support>
							</a:commandButton>
						</rich:column>
					</rich:dataTable>
					<rich:datascroller align="center" for="tabellaContadini" />
				</s:decorate>
			</h:form>
		</rich:simpleTogglePanel>
		
	 	<br/>
	 	<br/>
	 	<br/>
		
		<rich:simpleTogglePanel label="Categorie e prodotti">
		<h:form id="formCategory">
			<s:decorate id="categoriesField" template="/layout/edit.xhtml">
			
			<table width="96%" border="1" cellspacing="0" cellpadding="0" align="center" >
			<tr><td>
				<table width="90%" border="1" cellspacing="4" cellpadding="4" align="left" >	 
				<tr><td>
					<rich:dataTable width="20%" value="#{catalogService.getCategories(catalogService.contadino.partitaIva)}"
									var="_category">
						<rich:column> 
						<f:facet name="header">Categoria</f:facet>	
							<a:commandButton event="onclick" value="#{_category}"
										    action="#{catalogService.getItemsForCategory(catalogService.contadino,_category)}"
								          reRender="productsField" ajaxSingle="true">
								<f:setPropertyActionListener value="#{_category}"
									target="#{catalogService.currentCategory}" />
								<a:support event="onclick" action="#{takeInHand.azzeraHowMuch()}" ajaxSingle="true"/>
							</a:commandButton>
						</rich:column>	
					</rich:dataTable>
				</td>
				<td>
					<s:decorate id="productsField" template="/layout/edit.xhtml">
						<ui:define name="label">Prodotti</ui:define>
						<rich:dataTable width="75%" var="_item" id="itemsDataTable"
							value="#{catalogService.getItemsForCategory(catalogService.contadino, catalogService.currentCategory)}">
							<rich:column> 
								<f:facet name="header">Nome Prodotto</f:facet>
								<h:outputText value="#{_item.name}"/>
							</rich:column>
							<rich:column>
								<f:facet name="header">Descrizione</f:facet>
								<h:outputText value="#{_item.description}"/>
							</rich:column>	
							<rich:column>
								<f:facet name="header">Prezzo unitario</f:facet>
								<h:outputText value="#{_item.prezzo} euro"/>
							</rich:column>		
							<rich:column colspan="2">
								<f:facet name="header">Aggiungi al carrello</f:facet>
					 			<rich:inputNumberSpinner id="inputNumberSpinnerCarrello" minValue="0" maxValue="1000" step="1"
					 							value="#{takeInHand.howMuch}" style="height : 15px; width : 20px;">
					 				<a:support	event="onclick" action="#{takeInHand.addHowMuch(_item, takeInHand.howMuch)}"
					 						 reRender="valoreCarrelloColumn" ajaxSingle="true"/>
					 			</rich:inputNumberSpinner>						  	
					  			<a:commandButton id="commandButtonShoppingCart" image="/img/shopping_cart2.jpg" style="width : 25px; height : 25px;"
					  							 action="#{shoppingCart.addItemInShoppingCart(_item, takeInHand.getHowMuchForItem(_item),catalogService.contadino)}"
					  							 reRender="inputNumberSpinnerCarrello,valoreCarrelloColumn,shoppingcartField" ajaxSingle="true">
				 					<a:support event="onclick" action="#{takeInHand.azzeraHowMuch()}"
				 							reRender="shoppingcartField" ajaxSingle="true"/>
				 				</a:commandButton>
				 				<rich:toolTip for="commandButtonShoppingCart" value="Aggiungi prodotto al carrello"/>
							</rich:column>
							<rich:column id="valoreCarrelloColumn">
								<f:facet name="header">Totale per prodotto</f:facet> 
									<h:outputText value="#{takeInHand.howMuch * _item.prezzo} euro"/>
							</rich:column>
							</rich:dataTable>
						</s:decorate>
					</td></tr>
					</table>
				</td></tr>
				<tr><td>
				<table width="96%" border="2" cellspacing="0" cellpadding="0" align="center">
				<tr><td>
					<s:decorate id="shoppingcartField" template="/layout/edit.xhtml">
						<table>
						<tr><td>
						<ui:define name="label">Prodotti nel carrello</ui:define>
						<rich:dataTable var="_itemCarrello" id="itemsDataTableShoppingCart"
							value="#{shoppingCart.itemInShoppingCart}">
							<rich:column>
									<f:facet name="header">Nome prodotto</f:facet>
									<h:outputText value="#{_itemCarrello.item.name}"/>
							</rich:column>	
							<rich:column>
								<f:facet name="header">Username contadino</f:facet>
								<h:outputText value="#{_itemCarrello.cybercontadino.account.username}"/>
							</rich:column>	
							<rich:column>
									<f:facet name="header">Quantita prodotto</f:facet>
									<h:outputText value="#{_itemCarrello.quantita}"/>
							</rich:column>	
							<rich:column>
									<f:facet name="header">Totale per prodotto</f:facet>
									<h:outputText value="#{_itemCarrello.quantita * _itemCarrello.item.prezzo} euro"/>
							</rich:column>
							<rich:column>
								<f:facet name="header">Quantita minima</f:facet>
								<h:form>
									<h:selectBooleanCheckbox required="true" value="#{_itemCarrello.booleanIsQuantitaMinima}" > 
										<a:support event="onclick" ajaxSingle="true" reRendered="qParzialeField"/>
				  					</h:selectBooleanCheckbox>
			  						<a:outputPanel ajaxRendered="true">
										<s:decorate id="qParzialeField" rendered="#{_itemCarrello.booleanIsQuantitaMinima}">
											<rich:inputNumberSpinner id="qParzialeCarrello" 
								 							minValue="0" maxValue="#{_itemCarrello.quantita-1}" step="1"
								 							style="height : 15px; width : 20px;" 
								 						    value="#{_itemCarrello.quantitaParziale}">
								 			</rich:inputNumberSpinner>					
										</s:decorate>
									</a:outputPanel>
								</h:form>
							</rich:column>
							<rich:column>
							<f:facet name="header">Raggruppa ordine</f:facet>
								<h:form>
									<h:selectBooleanCheckbox  required="true" value="#{_itemCarrello.checkedForOrdine}">
										<a:support event="onclick" ajaxSingle="true"/>
									</h:selectBooleanCheckbox>
								</h:form>
							</rich:column>
							<rich:column>
									<f:facet name="header">Elimina dal carrello</f:facet>
									<a:commandButton id="commandButtonShoppingCartDelete" image="/img/shopping_cart2_delete.jpg"
													  style="width : 25px; height : 25px;">
					 					<a:support event="onclick" reRender="shoppingcartField" ajaxSingle="true"
					 						   action="#{shoppingCart.deleteItemInShoppingCart(_itemCarrello.item)}"/>
					 				</a:commandButton>
					 				<rich:toolTip for="commandButtonShoppingCartDelete" value="Elimina prodotto dal carrello"/>
							</rich:column>	
						</rich:dataTable>
						</td>
						<td>
						<table>
						<tr><td>
						<h:panelGrid columns="2" rendered="#{not empty shoppingCart.itemInShoppingCart}">
							<b><h:outputText value="TOTALE" style="font-weight:800"/></b>
							<b><h:outputText value="#{shoppingCart.calcolaTotale()} euro"  style="font-weight:600"/></b>
						</h:panelGrid>
						</td></tr>
						<tr><td>
						<h:panelGrid columns="1" rendered="#{not empty shoppingCart.itemInShoppingCart}">
							<s:decorate id="dataMassimaField" template="/layout/edit.xhtml">
		                		<ui:define name="label">Data massima consegna</ui:define>
		                		<rich:calendar id="dataMassimaCalendar" enableManualInput="true"
		                       		value="#{shoppingCart.dataMassima}" datePattern="dd/MM/yyyy HH:mm">
		                       	 	<a:support event="onchange" reRender="dataMassimaField" bypassUpdates="true" ajaxSingle="true"/>
		                		</rich:calendar>
            				</s:decorate>
			   			 </h:panelGrid>
			   			</td></tr>
						<tr><td>
					 		<a:commandButton id="commandButtonShoppingCartBuy" image="/img/shoppingCartBuy.jpg" 
					 				   rendered="#{not empty shoppingCart.itemInShoppingCart}"
					 				   reRender="shoppingcartField,outputTextSelectProduct,outputTextSelectDate,outputTextSelectDateBeforeToday"
									     action="#{shoppingCart.buySelectedItem()}">
					 		</a:commandButton>
					 		<rich:toolTip for="commandButtonShoppingCartBuy" value="Concludi acquisto"/>
					 		
					 		<s:decorate id="outputTextSelectProduct" rendered="#{ shoppingCart.noSelect==true and (not empty shoppingCart.itemInShoppingCart) }">
					 			<h:outputText value="Selezionare almeno un prodotto" />
					 		</s:decorate>
					 		<br/>
					 		<s:decorate id="outputTextSelectDate" rendered="#{ empty shoppingCart.dataMassima and (not empty shoppingCart.itemInShoppingCart) }">
					 			<h:outputText value="Selezionare una data massima di consegna"/>
					 		</s:decorate>
					 		<s:decorate id="outputTextSelectDateBeforeToday" rendered="#{ shoppingCart.dataMassimaBeforeToday and (not empty shoppingCart.itemInShoppingCart) }">
					 			<h:outputText value="Data massima non valida, troppo presto"/>
					 		</s:decorate>
						</td></tr>
						</table>
					</td></tr>
					</table>
					</s:decorate>
				</td></tr>
				</table>
			</td></tr>
			</table>	
		</s:decorate>				
		</h:form>
	</rich:simpleTogglePanel>
	
	</ui:define>

</ui:composition>

