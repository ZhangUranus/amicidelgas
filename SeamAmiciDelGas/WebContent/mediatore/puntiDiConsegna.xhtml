<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a="http://richfaces.org/a4j"
    template="/layout/template.xhtml">

	<ui:define name="body">

<script type="text/javascript" src="/SeamAmiciDelGas/js/gmap.js"></script>
<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAe6zQXGxcN5oso9n8RAEHiBR2bDFzeCT1WBspxZrlXfH7Q6YWYhSEDZPxM-Moytw3P41JRHiBSp0Xug"
      type="text/javascript"></script>
<script type="text/javascript"><!--
window.onunload = function(){
	GUnload();
}
window.onload = function(){
	load();
}		
--></script>

	<table width="99%" border="0" cellspacing="0" cellpadding="0" align="center" >
		<tr>
			<td>
				<table width="99%" border="0" cellspacing="4" cellpadding="0" align="center">
					<tr>
						<td width="50%">
							<div id="map1"  align="center" style="width: 98%; height: 380px"></div>
						</td>
						<td width="50%">
							<table width="98%" border="0" cellspacing="4" cellpadding="0" align="center">
								<tr>
									<td>
										<h:form id="addPuntoDiConsegnaForm">	
									    <rich:panel>
									        <f:facet name="header">Punto di consegna per la provincia di Benevento</f:facet>    
												
												<s:decorate id="comunePuntoField" template="/layout/edit.xhtml">
									                <ui:define name="label">Comune della provincia di bn</ui:define>
									                <h:inputText 
									                	id="comunePunto"
									                	size="50"
									               		value="Scrivere un comune (suggerimenti attivi)"
									               		required="true"
               											requiredMessage="Inserire il comune dove posizionare il punto di consegna"
									               		onclick="resetValue()">
									                </h:inputText>
									                <script type="text/javascript">
													<!--
														function resetValue(){
															document.getElementById('addPuntoDiConsegnaForm:comunePuntoField:comunePunto').value="";
														}
													//-->
													</script>
									             <rich:suggestionbox id="suggestionBoxId"
									             		size="50"
									             	 	nothingLabel="Nessun comune trovato per la provincia selezionata"
									             		usingSuggestObjects="true"
									             		suggestionAction="#{newComuneProvinciaBean.autocompleteForBenevento}" var="_comuneSugg"
									                    for="comunePunto" fetchValue="#{_comuneSugg.nome}" tokens=",[]"
									                    >
									                    <a:support event="onselect" ajaxSingle="true"  
									                 	action="#{newComuneProvinciaBean.setComune(_comuneSugg)}"/>
									                 <s:convertEntity></s:convertEntity>
									                    <h:column>
									                        <h:outputText value="#{_comuneSugg.nome}" />
									                    </h:column>
									             </rich:suggestionbox>  
									             </s:decorate>
												
									            
									            <s:decorate id="indirizzoField" template="/layout/edit.xhtml">
									                <ui:define name="label">Indirizzo (via)</ui:define>
									                <h:inputText id="indirizzo"
									                       required="true"
									                       requiredMessage="Inserire un indirizzo"
									                           size="50"
									                      maxlength="100"
									                          value="#{newPuntiDiConsegna.indirizzo}">
									                    <a:support event="onblur" reRender="indirizzoField" bypassUpdates="true" ajaxSingle="true"/>
									                </h:inputText>
									            </s:decorate>
									
											<div style="clear:both">
									                <span class="required">*</span>
									                Campi richiesti
									            </div>				
									            									            
										</rich:panel>   
											<h:commandButton id="addPunti" action="#{addPuntiDiConsegna.persistExtend()}" value="Aggiungi punto di consegna"/>
									    </h:form>
										
									</td>
								</tr>
								<tr>
									<td	height="16">									
									</td>
								</tr>
								<tr>
									<td>
										<a:region>
										<h:form>
											<rich:dataTable value="#{puntiDiConsegnaList.resultList}" var="_dati" id="table_punti_consegna" width="100%">
												<rich:column >
													<f:facet name="header">
														<h:outputText value="Indirizzo" />
													</f:facet>
													<h:outputText value="#{_dati.indirizzo}" id="indirizzo" />
								        		</rich:column>
								        		
								        		<rich:column >
													<f:facet name="header">
														<h:outputText value="Comune" />
													</f:facet>
													<h:outputText value="#{_dati.comune.nome}" id="comune" />
								        		</rich:column>
								        		
								        		<rich:column >
													<f:facet name="header">
														<h:outputText value="Provincia" />
													</f:facet>
													<h:outputText value="#{_dati.comune.provinces.idprovinces}" id="provincia" />
								        		</rich:column>
								        		
								        		<rich:column  align="center">
									                <f:facet name="header">
									                        Azioni
									                </f:facet>
									                <a:commandLink ajaxSingle="true" id="cancelPunto"
									                    oncomplete="#{rich:component('deletePuntoPanel')}.show()">
									                    <h:graphicImage value="/img/cancel_24px.png" style="border:0"/>
									                    <f:setPropertyActionListener value="#{_dati.idpuntiConsegna}"
					                        				target="#{puntiDiConsegnaHome.id}" />
									                </a:commandLink>
									                <rich:toolTip for="cancelPunto" value="Elimina questa punto di consegna"/>
									            </rich:column> 
										</rich:dataTable>
									</h:form>
									</a:region>
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
			</td>	
		</tr>
	</table>
	
	<ui:repeat value="#{puntiDiConsegnaList.resultList}" var="_punto">
<script type="text/javascript"><!--
	load();
	porcata("#{_punto.indirizzo}","#{_punto.comune.nome}","#{_punto.comune.provinces.nome}","#{_punto.idpuntiConsegna}");	
--></script>
</ui:repeat>
	
	<rich:modalPanel id="deletePuntoPanel" autosized="true" width="200">
      <f:facet name="header">
          <h:outputText value="Vuoi eliminare questo punto di consegna?"
              style="padding-right:15px;" />
      </f:facet>
      <f:facet name="controls">
          <h:panelGroup>
              <h:graphicImage value="/img/close.png"
                  styleClass="hidelink" id="hidelinkDelete" />
              <rich:componentControl for="deletePuntoPanel" attachTo="hidelinkDelete"
                  operation="hide" event="onclick" />
          </h:panelGroup>
      </f:facet>
      <h:form>
          <table width="100%">
              <tbody>
                  <tr>
                      <td align="center" width="45%">
              <a:commandButton value="Si" ajaxSingle="true"
                  action="#{puntiDiConsegnaHome.remove()}"
                  oncomplete="#{rich:component('deletePuntoPanel')}.hide();deletePoint('#{puntiDiConsegnaHome.instance.idpuntiConsegna}');"
                  reRender="table_punti_consegna" />
                      </td>
                      <td width="10%"></td>
                      <td align="center" width="45%">
              <a:commandButton value="No"
                  onclick="#{rich:component('deletePuntoPanel')}.hide();return false;" />
                      </td>
                  </tr>
              </tbody>
          </table>
      </h:form>
  </rich:modalPanel>
  

	
	</ui:define>
</ui:composition>